{"source":2,"revision":96,"description":null,"createdBy":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"createdOn":"2019-11-22T02:45:54.187Z","modifiedBy":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"modifiedOn":"2020-01-07T21:36:43.940Z","isDeleted":false,"lastRelease":{"id":331,"name":"Release-131","artifacts":[],"_links":{},"description":"","releaseDefinition":{"id":2,"projectReference":null,"_links":{}},"createdOn":"2020-01-07T20:42:28.780Z","createdBy":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"variables":{},"variableGroups":[],"environments":[{"id":7,"name":"Deploy to Dev","rank":1,"owner":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":21}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":22},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":23}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":3620,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 0.12.4","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"0.12.4"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (Env)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"dev-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (Env)","refName":"EnvTerraform","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"-var \"app_name=movieappwmp\" -var \"env_name=dev\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Get Terraform Output","refName":"ApplyEnvTerraform","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nexport topicId=$(cat $(EnvTerraform.jsonOutputVariablesPath) | jq -r '.topic_id.value')\necho \"##vso[task.setvariable variable=TopicId;isOutput=true]$topicId\"\n\nexport connectionString=$(cat $(EnvTerraform.jsonOutputVariablesPath) | jq -r '.mongo_connections.value[0]')\necho \"##vso[task.setvariable variable=MongoConnectionString;isOutput=true]$connectionString\"","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (App)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/userapi/main","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"userapi-dev-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (App)","refName":"ApplyTerraform","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/userapi/main","commandOptions":"-var \"env_name=dev\" -var \"app_name=movieappwmp\" -var \"image_name=userapi\" -var \"tag=$(Build.BuildId)\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Extract FuncApp Values","refName":"terraformPath","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nexport appServicePath=$(cat $(ApplyTerraform.jsonOutputVariablesPath) | jq -r '.funcapp_url.value')\n\necho \"##vso[task.setvariable variable=appservice_path;isOutput=true]$appServicePath\"","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Make sure app is ready","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nEXPECTED_RESPONSE_CODE=200\nMAX_ATTEMPTS=50\n\nresponseCode=0\nattemptNumber=0\n\necho $(terraformPath.appservice_path)\n\nwhile [ $responseCode -ne $EXPECTED_RESPONSE_CODE ] && [ $attemptNumber -lt $MAX_ATTEMPTS ]\ndo\n    echo 'Attempting Ping Check'\n    responseCode=$(curl --write-out %{http_code} --silent --output /dev/null $(terraformPath.appservice_path)/api/v1/ping)\n    echo $responseCode\n    sleep 5s\n\n    attemptNumber=attemptNumber+1\ndone","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"1.*","name":"Export Azure Information","refName":"azureData","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"#!/bin/bash\n\nexport subId=$(az account show --query id -o tsv)\n\nexport appName=$(echo \"$(terraformPath.appservice_path)\" | sed 's/^https:\\/\\/\\(.*\\).azurewebsites.net$/\\1/')\n\nexport resId=\"/subscriptions/$subId/resourceGroups/movieappwmp-rg/providers/Microsoft.Web/sites/$appName\"\n\nexport masterKey=$(az rest --method post --uri \"$resId/host/default/listKeys?api-version=2018-11-01\" | jq -r '.masterKey')\n\necho \"##vso[task.setvariable variable=funcAppMasterKey;isOutput=true]$masterKey\"","args":"","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (Subscriptions)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/userapi/subscriptions","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"userapi-subscriptions-dev","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (Subscriptions)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/userapi/subscriptions","commandOptions":"-var \"env_name=dev\" -var \"app_url=$(terraformPath.appservice_path)\" -var \"masterKey=$(azureData.funcAppMasterKey)\" -var \"app_name=movieappwmp\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":331,"url":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/releases/331","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://wmp.vsrm.visualstudio.com/_apis/public/Release/badge/c0673dc8-3300-493c-b1ce-bd8df2b959b1/2/7"},{"id":12,"name":"Deploy to Test","rank":2,"owner":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":36}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":37},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":38}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":3620,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 0.12.4","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"0.12.4"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (Env)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"test-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (Env)","refName":"EnvTerraform","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"-var \"app_name=movieappwmp\" -var \"env_name=test\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (App)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/userapi/main","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"userapi-test-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (App)","refName":"ApplyTerraform","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/userapi/main","commandOptions":"-var \"env_name=test\" -var \"app_name=movieappwmp\" -var \"image_name=userapi\" -var \"tag=$(Build.BuildId)\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Extract Service Url","refName":"terraformPath","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\ncat $(ApplyTerraform.jsonOutputVariablesPath)\n\nexport appServicePath=$(cat $(ApplyTerraform.jsonOutputVariablesPath) | jq -r '.funcapp_url.value')\necho $appServicePath\n\necho \"##vso[task.setvariable variable=appservice_path;isOutput=true]$appServicePath\"","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Wait till Functioin App is Ready","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nEXPECTED_RESPONSE_CODE=200\nMAX_ATTEMPTS=50\n\nresponseCode=0\nattemptNumber=0\n\necho $(terraformPath.appservice_path)\n\nwhile [ $responseCode -ne $EXPECTED_RESPONSE_CODE ] && [ $attemptNumber -lt $MAX_ATTEMPTS ]\ndo\n    echo 'Attempting Ping Check'\n    responseCode=$(curl --write-out %{http_code} --silent --output /dev/null $(terraformPath.appservice_path)/api/v1/ping)\n    echo $responseCode\n    sleep 5s\n\n    attemptNumber=attemptNumber+1\ndone","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"1.*","name":"Export Azure Information","refName":"azureData","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"#!/bin/bash\n\nexport subId=$(az account show --query id -o tsv)\n\nexport appName=$(echo \"$(terraformPath.appservice_path)\" | sed 's/^https:\\/\\/\\(.*\\).azurewebsites.net$/\\1/')\n\nexport resId=\"/subscriptions/$subId/resourceGroups/movieappwmp-rg/providers/Microsoft.Web/sites/$appName\"\n\nexport masterKey=$(az rest --method post --uri \"$resId/host/default/listKeys?api-version=2018-11-01\" | jq -r '.masterKey')\n\necho \"##vso[task.setvariable variable=funcAppMasterKey;isOutput=true]$masterKey\"","args":"","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (Subscriptions)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/userapi/subscriptions","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"userapi-subscriptions-test","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (Subscriptions)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/userapi/subscriptions","commandOptions":"-var \"env_name=test\" -var \"app_url=$(terraformPath.appservice_path)\" -var \"masterKey=$(azureData.funcAppMasterKey)\" -var \"app_name=movieappwmp\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":331,"url":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/releases/331","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://wmp.vsrm.visualstudio.com/_apis/public/Release/badge/c0673dc8-3300-493c-b1ce-bd8df2b959b1/2/12"}],"artifacts":[{"sourceId":"c0673dc8-3300-493c-b1ce-bd8df2b959b1:30b820a5-9c96-4649-8593-ea5b635bed51","type":"Git","alias":"Source","definitionReference":{"branches":{"id":"dev","name":"dev"},"checkoutNestedSubmodules":{"id":"True","name":"Any nested submodules within"},"checkoutSubmodules":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionType":{"id":"latestFromBranchType","name":"Latest from the default branch"},"definition":{"id":"30b820a5-9c96-4649-8593-ea5b635bed51","name":"DevOps-MovieAppTest"},"fetchDepth":{"id":"","name":""},"gitLfsSupport":{"id":"","name":""},"project":{"id":"c0673dc8-3300-493c-b1ce-bd8df2b959b1","name":"DevOps-MovieAppTest"}},"isRetained":false},{"sourceId":"c0673dc8-3300-493c-b1ce-bd8df2b959b1:639","type":"Build","alias":"UserApi","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://wmp.visualstudio.com/_permalink/_build/index?collectionId=5267842d-1b22-465b-a642-4a49d8d18366&projectId=c0673dc8-3300-493c-b1ce-bd8df2b959b1&definitionId=639","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"639","name":"UserApi Pipeline"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"c0673dc8-3300-493c-b1ce-bd8df2b959b1","name":"DevOps-MovieAppTest"},"repository":{"id":"","name":""}},"isPrimary":true,"isRetained":false}],"triggers":[{"artifactAlias":"UserApi","triggerConditions":[{"sourceBranch":"dev","tags":[],"tagFilter":null,"useBuildDefinitionBranch":false,"createReleaseOnBuildTagging":false}],"triggerType":1}],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseNew"},"IntegrateBoardsWorkItems":{"$type":"System.String","$value":"False"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"}},"id":2,"name":"UserApi","path":"\\","projectReference":null,"url":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/definitions/2","_links":{"self":{"href":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/definitions/2"},"web":{"href":"https://wmp.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_release?definitionId=2"}}}