{"source":2,"revision":41,"description":null,"createdBy":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"createdOn":"2019-12-06T19:13:12.800Z","modifiedBy":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"modifiedOn":"2020-01-07T19:48:33.420Z","isDeleted":false,"lastRelease":{"id":321,"name":"Release-53","artifacts":[],"_links":{},"description":"","releaseDefinition":{"id":3,"projectReference":null,"_links":{}},"createdOn":"2020-01-07T19:49:07.983Z","createdBy":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"variables":{"system.debug":{"value":"true"}},"variableGroups":[],"environments":[{"id":8,"name":"Dev Deploy","rank":1,"owner":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":24}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":25},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":26}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":3620,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 0.12.4","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"0.12.4"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (Env)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"dev-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (Env)","refName":"ApplyTerraform","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"-var \"app_name=movieappwmp\" -var \"env_name=dev\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (App)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/authapi","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"authapi-dev-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (App)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/authapi","commandOptions":"-var \"container_id=$(Build.BuildId)\" -var \"app_name=movieappwmp\" -var \"env_name=dev\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":321,"url":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/releases/321","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://wmp.vsrm.visualstudio.com/_apis/public/Release/badge/c0673dc8-3300-493c-b1ce-bd8df2b959b1/3/8"},{"id":9,"name":"Test Deploy","rank":2,"owner":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"variables":{"JwtKey":{"value":"ZDc5NzI1NWEtMTJlNi00NTBlLWI2NWEtMDVjNzllOWMyZjY4"}},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":27}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":28},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":29}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":3620,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Deploy","refName":null,"workflowTasks":[{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 0.12.4","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"0.12.4"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (Env)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"test-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (Env)","refName":"ApplyTerraformEnv","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"-var \"app_name=movieappwmp\" -var \"env_name=test\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (App)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/authapi","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"authapi-test-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (App)","refName":"ApplyTerraform","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/authapi","commandOptions":"-var \"container_id=$(Build.BuildId)\" -var \"app_name=movieappwmp\" -var \"env_name=test\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Get Outputs","refName":"TerraformAppOutput","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nexport appServicePath=$(cat $(ApplyTerraform.jsonOutputVariablesPath) | jq -r '.appservice_url.value')\necho $appServicePath\n\necho \"##vso[task.setvariable variable=appservice_path;isOutput=true]$appServicePath\"","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Ping Check","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nEXPECTED_RESPONSE_CODE=200\nMAX_ATTEMPTS=50\n\nresponseCode=0\nattemptNumber=0\n\necho $(terraformPath.appservice_path)\n\nwhile [ $responseCode -ne $EXPECTED_RESPONSE_CODE ] && [ $attemptNumber -lt $MAX_ATTEMPTS ]\ndo\n    echo 'Attempting Ping Check'\n    responseCode=$(curl --write-out %{http_code} --silent --output /dev/null https://$(terraformPath.appservice_path)/api/v1/ping)\n    echo $responseCode\n    sleep 5s\n\n    attemptNumber=attemptNumber+1\ndone","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Install newman","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nsudo npm install -g newman","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Execute API Tests","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"newman run AuthApi/Testing/Auth-Api.Tests.json --env-var \"host=$(TerraformAppOutput.appservice_path)\" --folder v1 --reporters=\"junit,cli\" --reporter-junit-export integration-test.xml","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"0b0f01ed-7dde-43ff-9cbb-e48954daf9b1","version":"2.*","name":"Publish Test Results","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeededOrFailed()","inputs":{"testRunner":"JUnit","testResultsFiles":"integration-test.xml","searchFolder":"$(System.DefaultWorkingDirectory)","mergeTestResults":"false","failTaskOnFailedTests":"false","testRunTitle":"","platform":"","configuration":"","publishRunAttachments":"true"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Destroy Terraform (App)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"always()","inputs":{"provider":"azurerm","command":"destroy","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/authapi","commandOptions":"-var \"container_id=$(Build.BuildId)\" -var \"app_name=movieappwmp\" -var \"env_name=test\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":321,"url":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/releases/321","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://wmp.vsrm.visualstudio.com/_apis/public/Release/badge/c0673dc8-3300-493c-b1ce-bd8df2b959b1/3/9"},{"id":11,"name":"Metric Deploy","rank":3,"owner":{"displayName":"Jason Farrell","url":"https://spsprodeus23.vssps.visualstudio.com/A0eb49e86-f9f0-4c65-a26d-24f6fc3808db/_apis/Identities/c77480b3-0174-6314-96b6-34b75ccb890e","_links":{"avatar":{"href":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"}},"id":"c77480b3-0174-6314-96b6-34b75ccb890e","uniqueName":"jfarrell@westmonroepartners.com","imageUrl":"https://wmp.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl","descriptor":"aad.Yzc3NDgwYjMtMDE3NC03MzE0LTk2YjYtMzRiNzVjY2I4OTBl"},"variables":{"JwtKey":{"value":"MDk5ODBhZWUtNGI3NS00ZTdjLWE0YWUtMWE3OTZkNWY0NGIy"}},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":33}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":34},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":35}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":3620,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Deploy","refName":null,"workflowTasks":[{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 0.12.4","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"0.12.4"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (Env)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"metric-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (Env)","refName":"ApplyTerraformEnv","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/environment","commandOptions":"-var \"app_name=movieappwmp\" -var \"env_name=metric\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Init Terraform (App)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/authapi","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","backendAzureRmResourceGroupName":"movieappwmp-rg","backendAzureRmStorageAccountName":"movieappwmpstate","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"authapi-metric-state","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Apply Terraform (App)","refName":"ApplyTerraform","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/authapi","commandOptions":"-var \"container_id=$(Build.BuildId)\" -var \"app_name=movieappwmp\" -var \"env_name=metric\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Get Outputs","refName":"TerraformAppOutput","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nexport appServicePath=$(cat $(ApplyTerraform.jsonOutputVariablesPath) | jq -r '.appservice_url.value')\necho $appServicePath\n\necho \"##vso[task.setvariable variable=appservice_path;isOutput=true]https://$appServicePath\"","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Ping Check","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nEXPECTED_RESPONSE_CODE=200\nMAX_ATTEMPTS=50\n\nresponseCode=0\nattemptNumber=0\n\necho $(terraformPath.appservice_path)\n\nwhile [ $responseCode -ne $EXPECTED_RESPONSE_CODE ] && [ $attemptNumber -lt $MAX_ATTEMPTS ]\ndo\n    echo 'Attempting Ping Check'\n    responseCode=$(curl --write-out %{http_code} --silent --output /dev/null $(terraformPath.appservice_path)/api/v1/ping)\n    echo $responseCode\n    sleep 5s\n\n    attemptNumber=attemptNumber+1\ndone","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Install artillery.io","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"#!/bin/bash\n\nsudo npm install -g artillery --ignore-scripts","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Execute Load Test","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"artillery run -t $(TerraformAppOutput.appservice_path) AuthApi/Testing/load-test.yaml -o load-results-raw\n\nartillery report  -o $(System.DefaultWorkingDirectory)/load-report.html load-results-raw\n\npwd\nls -l\ncat $(System.DefaultWorkingDirectory)/load-report.html","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Command Line Script","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"cat $(System.DefaultWorkingDirectory)/load-report.html","workingDirectory":"","failOnStderr":"false"}},{"environment":{},"taskId":"13f9d337-5ae6-4f96-9bc2-fe2b18a6319b","version":"1.*","name":"Publish Load Report","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"artifactName":"Load Report","htmlFilePath":"$(System.DefaultWorkingDirectory)/load-report.html"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Destroy Terraform (App)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"always()","inputs":{"provider":"azurerm","command":"destroy","workingDirectory":"$(System.DefaultWorkingDirectory)/Source/infrastructure/authapi","commandOptions":"-var \"container_id=$(Build.BuildId)\" -var \"app_name=movieappwmp\" -var \"env_name=metric\"","environmentServiceNameAzureRM":"e8a2b5c7-d558-48e9-82a1-f37a43b1f336","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"Test Deploy","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":321,"url":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/releases/321","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"testing"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://wmp.vsrm.visualstudio.com/_apis/public/Release/badge/c0673dc8-3300-493c-b1ce-bd8df2b959b1/3/11"}],"artifacts":[{"sourceId":"c0673dc8-3300-493c-b1ce-bd8df2b959b1:630","type":"Build","alias":"AuthApi","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://wmp.visualstudio.com/_permalink/_build/index?collectionId=5267842d-1b22-465b-a642-4a49d8d18366&projectId=c0673dc8-3300-493c-b1ce-bd8df2b959b1&definitionId=630","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"630","name":"AuthApi Pipeline"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"c0673dc8-3300-493c-b1ce-bd8df2b959b1","name":"DevOps-MovieAppTest"},"repository":{"id":"","name":""}},"isPrimary":true,"isRetained":false},{"sourceId":"c0673dc8-3300-493c-b1ce-bd8df2b959b1:30b820a5-9c96-4649-8593-ea5b635bed51","type":"Git","alias":"Source","definitionReference":{"branches":{"id":"dev","name":"dev"},"checkoutNestedSubmodules":{"id":"True","name":"Any nested submodules within"},"checkoutSubmodules":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionType":{"id":"latestFromBranchType","name":"Latest from the default branch"},"definition":{"id":"30b820a5-9c96-4649-8593-ea5b635bed51","name":"DevOps-MovieAppTest"},"fetchDepth":{"id":"","name":""},"gitLfsSupport":{"id":"","name":""},"project":{"id":"c0673dc8-3300-493c-b1ce-bd8df2b959b1","name":"DevOps-MovieAppTest"}},"isRetained":false}],"triggers":[{"artifactAlias":"AuthApi","triggerConditions":[{"sourceBranch":"dev","tags":[],"tagFilter":null,"useBuildDefinitionBranch":false,"createReleaseOnBuildTagging":false}],"triggerType":1}],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseNew"},"IntegrateBoardsWorkItems":{"$type":"System.String","$value":"False"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"}},"id":3,"name":"AuthApi","path":"\\","projectReference":null,"url":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/definitions/3","_links":{"self":{"href":"https://wmp.vsrm.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_apis/Release/definitions/3"},"web":{"href":"https://wmp.visualstudio.com/c0673dc8-3300-493c-b1ce-bd8df2b959b1/_release?definitionId=3"}}}